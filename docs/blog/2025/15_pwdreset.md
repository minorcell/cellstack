---
title: å¯†ç é‡ç½®æœºåˆ¶ï¼šå®‰å…¨é“¾æ¡ä¸Šä¸å®¹å¿½è§†çš„ä¸€ç¯
description: æ·±å…¥åˆ†æå¯†ç é‡ç½®æµç¨‹çš„å®‰å…¨é£é™©å’Œé˜²æŠ¤ç­–ç•¥ï¼Œæ„å»ºå¯é çš„å¯†ç é‡ç½®æœºåˆ¶
date: 2025-01-29
tags: 
  - å¯†ç å®‰å…¨
  - å¯†ç é‡ç½®
  - å®‰å…¨æœºåˆ¶
  - å‰åç«¯å®‰å…¨
  - èº«ä»½éªŒè¯
---

# å¯†ç é‡ç½®æœºåˆ¶ï¼šå®‰å…¨é“¾æ¡ä¸Šä¸å®¹å¿½è§†çš„ä¸€ç¯

åœ¨[å¯†ç å®‰å…¨ä½“ç³»](https://juejin.cn/post/7516041337352929316)ä¸­ï¼Œæˆ‘ä»¬è°ˆè®ºäº†[å¯†ç çš„æœ¬è´¨](https://juejin.cn/post/7517542575495479348)ã€[å“ˆå¸Œç®—æ³•çš„é€‰æ‹©](https://juejin.cn/post/7517501712573693978)ã€ä»¥åŠ[æ—¥å¸¸ç™»å½•åœºæ™¯ä¸‹çš„æ”»é˜²](https://juejin.cn/post/7517916583731773477)ã€‚ä½†è¿˜æœ‰ä¸€ä¸ªè‡³å…³é‡è¦çš„ç¯èŠ‚å¸¸å¸¸è¢«å¿½è§†ï¼Œé‚£å°±æ˜¯**å¯†ç é‡ç½®æœºåˆ¶**ã€‚

è¯•æƒ³ä¸€ä¸‹ï¼Œç”¨æˆ·å¿˜è®°å¯†ç äº†ï¼Œæˆ–è€…è´¦å·è¢«ç›—åéœ€è¦ç´§æ€¥ä¿®æ”¹å¯†ç ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°å¯†ç é‡ç½®åŠŸèƒ½ã€‚å¦‚æœè¿™ä¸ªæµç¨‹è®¾è®¡å¾—ä¸å¤Ÿä¸¥è°¨ï¼Œé‚£ä¹ˆå³ä½¿ä½ çš„å¯†ç å­˜å‚¨å†å®‰å…¨ï¼Œæ”»å‡»è€…ä¹Ÿå¯èƒ½é€šè¿‡é‡ç½®åŠŸèƒ½è½»æ¾æ¥ç®¡ç”¨æˆ·è´¦æˆ·ã€‚è¿™å°±åƒå®¶é‡Œçš„é˜²ç›—é—¨å†åšå›ºï¼Œå¦‚æœé’¥åŒ™å¯ä»¥è½»æ˜“å¤åˆ¶æˆ–è¢«éª—èµ°ï¼Œé‚£å®‰å…¨æ€§ä¾ç„¶å½¢åŒè™šè®¾ã€‚

ä»Šå¤©ï¼Œæˆ‘ä»¬å°±æ¥æ·±å…¥æ¢è®¨å¯†ç é‡ç½®æœºåˆ¶ä¸­çš„å®‰å…¨è€ƒé‡ï¼Œä»¥åŠå¦‚ä½•é€šè¿‡å‰åç«¯åä½œï¼Œæ„ç­‘ä¸€é“åšå®çš„é˜²çº¿ã€‚

---

### ğŸ£ å¸¸è§çš„å¯†ç é‡ç½®æµç¨‹ä¸æ½œåœ¨é£é™©

ç›®å‰ä¸»æµçš„å¯†ç é‡ç½®æµç¨‹ï¼Œé€šå¸¸ä¾èµ–äºä»¥ä¸‹å‡ ç§æ–¹å¼ï¼š

1.  **åŸºäºé‚®ç®±éªŒè¯ç /é“¾æ¥**ï¼šç”¨æˆ·è¾“å…¥æ³¨å†Œé‚®ç®±ï¼Œç³»ç»Ÿå‘é€ä¸€ä¸ªå¸¦æœ‰éªŒè¯ç æˆ–å”¯ä¸€é‡ç½®é“¾æ¥çš„é‚®ä»¶ã€‚ç”¨æˆ·ç‚¹å‡»é“¾æ¥æˆ–è¾“å…¥éªŒè¯ç åï¼Œå³å¯è®¾ç½®æ–°å¯†ç ã€‚
1.  **åŸºäºæ‰‹æœºçŸ­ä¿¡éªŒè¯ç **ï¼šä¸é‚®ç®±ç±»ä¼¼ï¼Œç³»ç»Ÿå‘ç”¨æˆ·ç»‘å®šçš„æ‰‹æœºå‘é€çŸ­ä¿¡éªŒè¯ç ã€‚
1.  **åŸºäºå®‰å…¨é—®é¢˜**ï¼šç”¨æˆ·å›ç­”é¢„è®¾çš„å®‰å…¨é—®é¢˜ï¼ˆå¦‚"ä½ æ¯äº²çš„å§“æ°ï¼Ÿ"ï¼‰ã€‚

è¿™äº›æµç¨‹çœ‹ä¼¼æ–¹ä¾¿ï¼Œä½†æ¯ä¸€ä¸ªç¯èŠ‚éƒ½å¯èƒ½æˆä¸ºæ”»å‡»è€…çš„ç›®æ ‡ï¼š

- **é‚®ç®±/æ‰‹æœºå·è¢«ç›—ç”¨**ï¼šè¿™æ˜¯æœ€ç›´æ¥çš„é£é™©ã€‚å¦‚æœæ”»å‡»è€…èƒ½è·å–ç”¨æˆ·çš„é‚®ç®±æˆ–æ‰‹æœºæ§åˆ¶æƒï¼Œå°±èƒ½ç›´æ¥æ¥æ”¶é‡ç½®ä¿¡æ¯ã€‚
- **éªŒè¯ç æš´åŠ›ç ´è§£**ï¼šå¦‚æœå¯¹éªŒè¯ç å°è¯•æ¬¡æ•°æ²¡æœ‰é™åˆ¶ï¼Œæ”»å‡»è€…å¯èƒ½é€šè¿‡ç¨‹åºæš´åŠ›çŒœè§£éªŒè¯ç ã€‚
- **é‡ç½®é“¾æ¥å¯é¢„æµ‹/è¿‡æœŸæ—¶é—´è¿‡é•¿**ï¼šå¦‚æœé‡ç½®é“¾æ¥çš„ç”Ÿæˆç®—æ³•ä¸å¤Ÿéšæœºï¼Œæˆ–è€…é“¾æ¥é•¿æœŸæœ‰æ•ˆï¼Œæ”»å‡»è€…å°±æœ‰æœºä¼šåŠ«æŒæˆ–åˆ©ç”¨å¤±æ•ˆçš„é“¾æ¥ã€‚
- **å®¢æˆ·ç«¯ç¯¡æ”¹è¯·æ±‚**ï¼šæ”»å‡»è€…å¯èƒ½é€šè¿‡æŠ“åŒ…ã€ä¿®æ”¹è¯·æ±‚å‚æ•°ç­‰æ–¹å¼ï¼Œè·³è¿‡æŸäº›éªŒè¯æ­¥éª¤ã€‚

---

### ç­‘ç‰¢é˜²çº¿ï¼šå‰åç«¯ååŒé˜²å¾¡

ä¸ºäº†æœ‰æ•ˆåº”å¯¹ä¸Šè¿°é£é™©ï¼Œæˆ‘ä»¬éœ€è¦å‰åç«¯ç´§å¯†é…åˆï¼Œå®æ–½å¤šå±‚é˜²å¾¡ã€‚

#### 1. å‰ç«¯ï¼šæä¾›ç”¨æˆ·ä½“éªŒä¸åˆæ­¥é˜²æŠ¤

å‰ç«¯åœ¨å¯†ç é‡ç½®æµç¨‹ä¸­ï¼Œä¸»è¦æ˜¯ä¸ºäº†æå‡ç”¨æˆ·ä½“éªŒå’Œè¿›è¡Œä¸€äº›åˆæ­¥çš„é™åˆ¶ï¼š

- **è¾“å…¥æ ¡éªŒ**ï¼šå¯¹ç”¨æˆ·è¾“å…¥çš„é‚®ç®±/æ‰‹æœºå·è¿›è¡Œæ ¼å¼æ ¡éªŒã€‚
- **éªŒè¯ç è¾“å…¥é™åˆ¶**ï¼šé™åˆ¶ç”¨æˆ·åœ¨å‰ç«¯è¾“å…¥éªŒè¯ç çš„é¢‘ç‡å’Œé•¿åº¦ã€‚
- **å‹å¥½çš„é”™è¯¯æç¤º**ï¼šé¿å…æ³„éœ²è¿‡å¤šæ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚ä¸è¦æç¤º"è¯¥é‚®ç®±ä¸å­˜åœ¨"ï¼Œè€Œåº”æç¤º"é‡ç½®è¯·æ±‚å·²å‘é€ï¼ˆå¦‚æœè´¦å·å­˜åœ¨ï¼‰"ã€‚
- **ç¦ç”¨é‡å¤ç‚¹å‡»**ï¼šåœ¨å‘é€éªŒè¯ç åï¼Œç¦ç”¨"å‘é€éªŒè¯ç "æŒ‰é’®ä¸€æ®µæ—¶é—´ï¼Œé˜²æ­¢ç”¨æˆ·é¢‘ç¹ç‚¹å‡»ã€‚

```js
// å‰ç«¯ä¼ªä»£ç ï¼šå‘é€é‡ç½®é‚®ä»¶/çŸ­ä¿¡æ—¶
document
  .getElementById("resetPasswordButton")
  .addEventListener("click", async () => {
    const email = document.getElementById("emailInput").value;
    if (!isValidEmail(email)) {
      // ç®€å•çš„é‚®ç®±æ ¼å¼æ ¡éªŒ
      alert("è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€");
      return;
    }

    // ç¦ç”¨æŒ‰é’®å¹¶å¼€å§‹å€’è®¡æ—¶ï¼Œé˜²æ­¢é¢‘ç¹ç‚¹å‡»
    const btn = document.getElementById("sendCodeButton");
    btn.disabled = true;
    let countdown = 60;
    const timer = setInterval(() => {
      btn.textContent = `é‡æ–°å‘é€ (${countdown}s)`;
      countdown--;
      if (countdown < 0) {
        clearInterval(timer);
        btn.textContent = "å‘é€éªŒè¯ç ";
        btn.disabled = false;
      }
    }, 1000);

    try {
      const response = await fetch("/api/reset-password/request", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email }),
      });
      if (response.ok) {
        alert("é‡ç½®é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±ã€‚");
      } else {
        // è¿™é‡Œä¸åº”æš´éœ²å…·ä½“é”™è¯¯ä¿¡æ¯ï¼Œç»Ÿä¸€æç¤º
        alert("è¯·æ±‚å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚");
      }
    } catch (error) {
      console.error("Network error:", error);
      alert("ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ç½‘ç»œè¿æ¥ã€‚");
    }
  });
```

**æ€è€ƒï¼šä¸ºä»€ä¹ˆå‰ç«¯çš„é”™è¯¯æç¤ºä¸åº”è¿‡äºå…·ä½“ï¼Ÿè¿™èƒŒåéšè—ç€æ€æ ·çš„å®‰å…¨è€ƒé‡ï¼Ÿ**

#### 2. åç«¯ï¼šå®‰å…¨é‡ç½®æœºåˆ¶çš„å®ˆæŠ¤è€…

åç«¯æ‰æ˜¯å¯†ç é‡ç½®å®‰å…¨çš„æ ¸å¿ƒï¼Œéœ€è¦æ‰¿æ‹…ç»å¤§éƒ¨åˆ†çš„é˜²å¾¡èŒè´£ã€‚

- **ç”Ÿæˆå®‰å…¨ä»¤ç‰Œ/éªŒè¯ç **ï¼š

  - **å”¯ä¸€æ€§ä¸éšæœºæ€§**ï¼šé‡ç½®ä»¤ç‰Œï¼ˆæˆ–éªŒè¯ç ï¼‰å¿…é¡»æ˜¯åŠ å¯†å®‰å…¨çš„éšæœºå­—ç¬¦ä¸²ï¼Œä¸å¯é¢„æµ‹ã€‚é€šå¸¸é•¿åº¦åº”è¶³å¤Ÿé•¿ï¼ˆå¦‚ UUID æˆ–æ›´é•¿çš„éšæœºå­—èŠ‚ä¸²ï¼‰ã€‚
  - **ä¸€æ¬¡æ€§ä½¿ç”¨**ï¼šæ¯ä¸ªä»¤ç‰Œ/éªŒè¯ç åªèƒ½ä½¿ç”¨ä¸€æ¬¡ï¼Œæ— è®ºæˆåŠŸä¸å¦ï¼Œä¸€æ—¦ä½¿ç”¨å°±ç«‹å³å¤±æ•ˆã€‚
  - **ä¸¥æ ¼çš„æœ‰æ•ˆæœŸ**ï¼šé‡ç½®ä»¤ç‰Œ/éªŒè¯ç åº”è®¾ç½®è¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼ˆä¾‹å¦‚ 5-15 åˆ†é’Ÿï¼‰ï¼Œå³ä½¿è¢«æ³„éœ²ï¼Œå…¶æœ‰æ•ˆæ—¶é—´çª—ä¹Ÿæå…¶æœ‰é™ã€‚
  - **ä¸ç”¨æˆ·ç»‘å®š**ï¼šä»¤ç‰Œ/éªŒè¯ç å¿…é¡»ä¸ç”¨æˆ·çš„èº«ä»½ï¼ˆé‚®ç®±/æ‰‹æœºå·ï¼‰ä¸¥æ ¼ç»‘å®šã€‚

  ```go
  // Go è¯­è¨€ä¼ªä»£ç ï¼šç”Ÿæˆå¯†ç é‡ç½®ä»¤ç‰Œ
  type PasswordResetToken struct {
      Token     string    `json:"token"`
      UserID    string    `json:"user_id"`
      ExpiresAt time.Time `json:"expires_at"`
      Used      bool      `json:"used"`
  }

  func GenerateResetToken(userID string) (*PasswordResetToken, error) {
      // ç”Ÿæˆä¸€ä¸ªè¶³å¤Ÿé•¿çš„éšæœºå­—ç¬¦ä¸²ä½œä¸ºä»¤ç‰Œ
      tokenBytes := make([]byte, 32) // 32å­—èŠ‚ï¼Œå³256ä½éšæœºæ€§
      _, err := rand.Read(tokenBytes)
      if err != nil {
          return nil, fmt.Errorf("failed to generate random token: %w", err)
      }
      token := base64.URLEncoding.EncodeToString(tokenBytes)

      expiresAt := time.Now().Add(15 * time.Minute) // ä»¤ç‰Œ15åˆ†é’Ÿåè¿‡æœŸ

      resetToken := &PasswordResetToken{
          Token:     token,
          UserID:    userID,
          ExpiresAt: expiresAt,
          Used:      false,
      }
      // å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œéœ€è¦å°† token å­˜å‚¨åˆ°æ•°æ®åº“æˆ–ç¼“å­˜ä¸­
      // ä¾‹å¦‚ï¼šdb.Save(resetToken)
      return resetToken, nil
  }
  ```

- **ä¸¥æ ¼çš„éªŒè¯æµç¨‹**ï¼š

  - **å¤šå› ç´ éªŒè¯ï¼ˆå¦‚æœé€‚ç”¨ï¼‰** ï¼šåœ¨é‡ç½®å¯†ç æ—¶ï¼Œå¦‚æœèƒ½ç»“åˆç”¨æˆ·çš„å…¶ä»–èº«ä»½ä¿¡æ¯ï¼ˆå¦‚æ‰‹æœºéªŒè¯ç +é‚®ç®±éªŒè¯ï¼‰ï¼Œå°†å¤§å¤§æé«˜å®‰å…¨æ€§ã€‚

  - **éªŒè¯ç /ä»¤ç‰Œçš„æ ¡éªŒ**ï¼š

    - æ£€æŸ¥ä»¤ç‰Œ/éªŒè¯ç æ˜¯å¦å­˜åœ¨ã€‚
    - æ£€æŸ¥æ˜¯å¦å·²è¿‡æœŸã€‚
    - æ£€æŸ¥æ˜¯å¦å·²ä½¿ç”¨è¿‡ã€‚
    - æ£€æŸ¥ä»¤ç‰Œ/éªŒè¯ç æ˜¯å¦ä¸è¯·æ±‚ç”¨æˆ·åŒ¹é…ã€‚

  ```go
  // Go è¯­è¨€ä¼ªä»£ç ï¼šéªŒè¯å¯†ç é‡ç½®ä»¤ç‰Œå¹¶æ›´æ–°å¯†ç 
  func ResetPassword(token string, newPassword string) error {
      // 1. ä»æ•°æ®åº“ä¸­æŸ¥æ‰¾ä»¤ç‰Œ
      // tokenRecord := db.FindToken(token) // å‡è®¾ä»æ•°æ®åº“è·å–ä»¤ç‰Œè®°å½•

      // ä¼ªä»£ç æ¨¡æ‹Ÿä»å­˜å‚¨ä¸­è·å–ä»¤ç‰Œ
      tokenRecord := &PasswordResetToken{
          Token: token,
          UserID: "someUserID", // å®é™…åº”ä»æ•°æ®åº“æŸ¥è¯¢
          ExpiresAt: time.Now().Add(5 * time.Minute),
          Used: false,
      }
      if tokenRecord == nil {
          return fmt.Errorf("invalid or non-existent token")
      }

      // 2. æ£€æŸ¥ä»¤ç‰ŒçŠ¶æ€
      if tokenRecord.Used {
          return fmt.Errorf("token already used")
      }
      if time.Now().After(tokenRecord.ExpiresAt) {
          return fmt.Errorf("token expired")
      }

      // 3. å¯¹æ–°å¯†ç è¿›è¡Œå“ˆå¸Œå­˜å‚¨ï¼ˆä½¿ç”¨Bcryptç­‰å¼ºå“ˆå¸Œç®—æ³•ï¼‰
      hashedPassword, err := bcrypt.GenerateFromPassword([]byte(newPassword), bcrypt.DefaultCost)
      if err != nil {
          return fmt.Errorf("failed to hash new password: %w", err)
      }

      // 4. æ›´æ–°ç”¨æˆ·å¯†ç 
      // db.UpdateUserPassword(tokenRecord.UserID, string(hashedPassword)) // æ›´æ–°ç”¨æˆ·å¯†ç 
      log.Printf("User %s password updated successfully.", tokenRecord.UserID)

      // 5. æ ‡è®°ä»¤ç‰Œå·²ä½¿ç”¨ï¼ˆå…³é”®æ­¥éª¤ï¼ï¼‰
      // tokenRecord.Used = true
      // db.Save(tokenRecord) // æ›´æ–°ä»¤ç‰ŒçŠ¶æ€
      log.Printf("Reset token %s marked as used.", tokenRecord.Token)

      return nil
  }
  ```

- **é˜²æš´åŠ›ç ´è§£æªæ–½**ï¼šå¯¹é‡ç½®è¯·æ±‚ï¼ˆä¾‹å¦‚å‘é€éªŒè¯ç æ¥å£ï¼‰å’ŒéªŒè¯éªŒè¯ç æ¥å£éƒ½åº”ç”¨é€Ÿç‡é™åˆ¶å’ŒéªŒè¯ç æœºåˆ¶ï¼Œä¸ç™»å½•æ¥å£ç±»ä¼¼ã€‚

- **å®‰å…¨é‚®ä»¶/çŸ­ä¿¡å‘é€**ï¼šç¡®ä¿é‚®ä»¶æœåŠ¡å•†æˆ–çŸ­ä¿¡é€šé“æœ¬èº«çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢è¿™äº›æœåŠ¡è¢«æ”»å‡»è€…åˆ©ç”¨ã€‚

- **æ—¥å¿—è®°å½•ä¸å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰å¯†ç é‡ç½®è¯·æ±‚å’Œæ“ä½œï¼ŒåŒ…æ‹¬ IP åœ°å€ã€æ—¶é—´ã€çŠ¶æ€ç­‰ï¼Œä»¥ä¾¿åç»­å®¡è®¡å’Œå®‰å…¨åˆ†æã€‚

- **é‡ç½®æˆåŠŸåçš„é€šçŸ¥**ï¼šåœ¨å¯†ç æˆåŠŸé‡ç½®åï¼Œé€šè¿‡ç”¨æˆ·åŸæœ‰çš„å®‰å…¨è”ç³»æ–¹å¼ï¼ˆå¦‚é‚®ç®±æˆ–æ‰‹æœºï¼‰å‘é€é€šçŸ¥ï¼Œæé†’ç”¨æˆ·å…¶å¯†ç å·²æ›´æ”¹ã€‚å¦‚æœä¸æ˜¯æœ¬äººæ“ä½œï¼Œç”¨æˆ·å¯ä»¥åŠæ—¶å‘ç°å¹¶é‡‡å–è¡ŒåŠ¨ã€‚**è¿™æ˜¯å¾ˆå¤šå¤§å‹äº’è”ç½‘å…¬å¸éƒ½åœ¨åšçš„æœ€ä½³å®è·µã€‚**

---

### å¯†ç é‡ç½®ï¼šæ”»é˜²çš„"æœ€åä¸€å…¬é‡Œ"

å¯†ç é‡ç½®æœºåˆ¶æ˜¯ç”¨æˆ·è´¦æˆ·å®‰å…¨çš„"æœ€åä¸€å…¬é‡Œ"ã€‚ä¸€ä¸ªè®¾è®¡ä¸å½“çš„é‡ç½®æµç¨‹ï¼Œä¼šæŠŠä¹‹å‰åœ¨å¯†ç å­˜å‚¨å’Œç™»å½•éªŒè¯ä¸Šåšçš„ä¸€åˆ‡åŠªåŠ›ä»˜ä¹‹ä¸€ç‚¬ã€‚å¼€å‘è€…åœ¨è®¾è®¡å’Œå®ç°è¿™ä¸€åŠŸèƒ½æ—¶ï¼Œå¿…é¡»å¸¦ç€å¯¹é£é™©çš„æ•¬ç•ï¼Œç¡®ä¿æ¯ä¸ªç¯èŠ‚çš„å®‰å…¨æ€§ã€‚